@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import config._
@import helpers.pageHeadersAndError
@import views.html.helper.form
@import uk.gov.hmrc.govukfrontend.views.html.components._
@this(bcMain: bcMain, formHelper: FormWithCSRF, govukTable : GovukTable)

@(service: String, businessDetails: models.ReviewDetails, backLink: Option[String])(implicit request: Request[AnyContent], messages: Messages, appConfig: ApplicationConfig)


@bcMain(title = messages("business-review.agent-editable.title", service), service = service) {

  @pageHeadersAndError(backLink, "bc.business-registration-agent.text", messages("bc.business-registration.text.agent", service.toUpperCase), "bc.business-registration-agent.header", messages("business-review.agent-editable.title"))

  <div class="govuk-warning-text">
      <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
      <div id="check-agency-details">
      <strong class="govuk-warning-text__text">
          <span class="govuk-warning-text__assistive">Warning</span>
            @messages("business-review.check-agency.text")
      </strong>
      </div>
  </div>


      <table id="business-details" class="govuk-table">
      <tr class="govuk-table__row">
        <th scope="row" id="business-name-title" class="govuk-table__header">
          @messages("business-review.business-name")
        </th>
        <td id="business-name" class="govuk-table__cell">
          @businessDetails.businessName
        </td>
        <td class="govuk-table__cell">
          <a href='@controllers.nonUKReg.routes.UpdateNonUKBusinessRegistrationController.editAgent(service)' id="business-name-edit">@messages("bc.edit")
            <span class="govuk-visually-hidden">@messages("business-review.business-name")</span>
          </a>
        </td>
      </tr>

      <tr class="govuk-table__row">
        <th scope="row" id="business-address-title" class="govuk-table__header">
             @messages("business-review.address")
        </th>
        <td id="business-address" class="govuk-table__cell">
            <p class="govuk-body">
            @businessDetails.businessAddress.line_1<br>
            @businessDetails.businessAddress.line_2<br>
            @businessDetails.businessAddress.line_3.map {line_3 =>@line_3<br>}
            @businessDetails.businessAddress.line_4.map {line_4 =>@line_4<br>}
            @businessDetails.businessAddress.postcode.map {postcode =>@postcode<br>}
            @appConfig.getSelectedCountry(businessDetails.businessAddress.country)<br>
            </p>
        </td>
        </td>

        <td class="govuk-table__cell">
          <a href='@controllers.nonUKReg.routes.UpdateNonUKBusinessRegistrationController.editAgent(service)' id="business-reg-edit">@messages("bc.edit")
            <span class="govuk-visually-hidden">@messages("business-review.address")</span>
          </a>
        </td>

      </tr>

      @businessDetails.identification.map { identification =>

        <tr class="govuk-table__row">
          <th scope="row" class="govuk-table__header">@messages("bc.non-uk-reg.businessUniqueId")</th>
          <td class="govuk-table__cell">@identification.idNumber</td>
          <td class="govuk-table__cell">
            <a href='@controllers.nonUKReg.routes.UpdateOverseasCompanyRegController.viewForUpdate(service, false)'>@messages("bc.edit")
              <span class="govuk-visually-hidden">@messages("bc.non-uk-reg.businessUniqueId")</span>
            </a>
          </td>
        </tr>

        <tr class="govuk-table__row">
          <th scope="row" class="govuk-table__header">@messages("bc.non-uk-reg.issuingCountry")</th>
          <td class="govuk-table__cell">@appConfig.getSelectedCountry(identification.issuingCountryCode)</td>
          <td class="govuk-table__cell">
            <a href='@controllers.nonUKReg.routes.UpdateOverseasCompanyRegController.viewForUpdate(service, false)'>@messages("bc.edit")
              <span class="govuk-visually-hidden">@messages("bc.non-uk-reg.issuingCountry")</span>
            </a>
          </td>
        </tr>

        <tr class="govuk-table__row">
          <th scope="row" class="govuk-table__header">@messages("bc.non-uk-reg.issuingInstitution")</th>
          <td class="govuk-table__cell">@identification.issuingInstitution</td>
          <td class="govuk-table__cell">
            <a href='@controllers.nonUKReg.routes.UpdateOverseasCompanyRegController.viewForUpdate(service, false)'>@messages("bc.edit")
              <span class="govuk-visually-hidden">@messages("bc.non-uk-reg.issuingInstitution")</span>
            </a>
          </td>
        </tr>

      }.getOrElse {

        <tr class="govuk-table__row">
          <th scope="row" class="govuk-table__header">@messages("business-review.overseas-tax-reference")</th>
          <td class="govuk-table__cell">@messages("business-review.overseas-tax-reference.not-provided")</td>
          <td class="govuk-table__cell">
            <a href='@controllers.nonUKReg.routes.UpdateOverseasCompanyRegController.viewForUpdate(service, false)'>@messages("bc.edit")
              <span class="govuk-visually-hidden">@messages("business-review.overseas-tax-reference")</span>
            </a>
          </td>
        </tr>

      }
    
  </table>

  <div class="govuk-form-group">
      @formHelper(action = controllers.routes.ReviewDetailsController.continue(service)) {
      <button class="govuk-button" id="submit" type="submit">
        @messages("business-review.registration-button")
      </button>
    }
  </div>
}
