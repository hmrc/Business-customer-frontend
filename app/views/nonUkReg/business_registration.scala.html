@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import config.ApplicationConfig
@import uk.gov.hmrc.play.views.html.helpers.form
@import views.html.helpers._
@this(bcMain: bcMain)

@(businessRegistrationForm: Form[models.BusinessRegistration],
  service: String,
  displayDetails: models.BusinessRegistrationDisplayDetails,
  backLink: Option[String],
  isAgent: Boolean)(implicit request: Request[_], messages: Messages, appConfig: ApplicationConfig)

@pageScripts = {
  <script src='@controllers.routes.Assets.versioned("javascript/accessible-autocomplete.min.js")'></script>
  <script>
    $(document).ready(function() {

      accessibleAutocomplete.enhanceSelectElement({
        selectElement: document.querySelector('#businessAddress\\.country')
      })

    });
  </script>
}

@submitButtonText = @{
  isAgent match {
    case true => messages("bc.business-verification.submit")
    case false => messages("bc.business-verification.submit.client")
  }
}

@bcMain(title = messages(displayDetails.businessRegHeader), service = service, pageScripts = Some(pageScripts)) {

  @pageHeadersAndError(
    backLink,
    "business-verification-text",
    messages(displayDetails.businessRegSubHeader, service),
    "business-registration-header",
    messages(displayDetails.businessRegHeader),
    Some(bcErrorSummary(businessRegistrationForm, "bc.business-registration-error.general"))
  )

  @displayDetails.businessRegLede.map { businessRegLede =>
    <p class="lede" id="business-registration-lede">@Html(messages(businessRegLede))</p>
  }

  @form(action = controllers.nonUKReg.routes.BusinessRegController.send(service, messages(displayDetails.businessType))) {
    <div id="business-registration-form">

      <fieldset>
        <legend class="visuallyhidden">@messages(displayDetails.businessRegHeader)</legend>
        @bcInput(businessRegistrationForm("businessName"),
          '_label ->  Html(messages("bc.business-registration.businessName")),
          '_labelClass -> "form-label-bold",
          '_id -> "businessName",
          '_showConstraints -> false
        )

        @bcInput(businessRegistrationForm("businessAddress.line_1"),
          '_label ->  Html(messages("bc.business-registration.line_1")),
          '_labelClass -> "form-label-bold",
          '_id -> "businessAddress.line_1",
          '_showConstraints -> false
        )

        @bcInput(businessRegistrationForm("businessAddress.line_2"),
          '_label ->  Html(messages("bc.business-registration.line_2")),
          '_labelClass -> "form-label-bold",
          '_id -> "businessAddress.line_2",
          '_showConstraints -> false
        )

        @bcInput(businessRegistrationForm("businessAddress.line_3"),
          '_label ->  Html(messages("bc.business-registration.line_3")),
          '_labelClass -> "form-label-bold",
          '_id -> "businessAddress.line_3",
          '_showConstraints -> false
        )

        @bcInput(businessRegistrationForm("businessAddress.line_4"),
          '_label ->  Html(messages("bc.business-registration.line_4")),
          '_labelClass -> "form-label-bold",
          '_id -> "businessAddress.line_4",
          '_showConstraints -> false
        )

        @if(!isAgent) {
          @bcInput(businessRegistrationForm("businessAddress.postcode"),
            '_label ->  Html(messages("bc.non-uk-reg.postcode")),
            '_labelClass -> "form-label-bold",
            '_id -> "businessAddress.postcode",
            '_inputClass -> "input--small",
            '_maxLength -> 10,
            '_showConstraints -> false
          )

          <details>
            <summary aria-controls="details-content-0" tabindex="0" class="summary" id="email-risk-question" data-journey-click="ated-subscription:click:email-risk-question">
              @messages("bc.non-uk-reg.postcode.help.question")
            </summary>
            <div id="details-content-0" class="panel-indent font-xsmall">
              <p id="email-risk-ans">@Html(messages("bc.non-uk-reg.postcode.help.answer"))</p>
            </div>
          </details>

        }

        @bcDropdown(businessRegistrationForm("businessAddress.country"),
          elementOptions = displayDetails.listOfIsoCode,
          displayEmptyValue = true,
          '_id -> "businessAddress.country",
          '_labelClass -> "form-label-bold",
          '_label -> Html(messages("bc.business-registration.country"))
        )

      </fieldset>
    </div>

    <button id="submit" type="submit" class="button">@submitButtonText</button>
  }
}
